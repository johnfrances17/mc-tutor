<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - MC Tutor</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .login-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .login-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 900px;
      width: 100%;
      overflow: hidden;
    }

    .login-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 40px;
      text-align: center;
      color: white;
    }

    .login-header h1 {
      margin: 0 0 8px 0;
      font-size: 36px;
      font-weight: 700;
    }

    .login-header p {
      margin: 0;
      font-size: 16px;
      opacity: 0.95;
    }

    .login-header .institution {
      margin-top: 5px;
      font-size: 13px;
      opacity: 0.85;
    }

    .login-body {
      padding: 50px;
    }

    .role-selection h2 {
      text-align: center;
      color: #333;
      font-size: 28px;
      margin: 0 0 40px 0;
      font-weight: 600;
    }

    .role-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }

    .role-card {
      background: #f8f9fa;
      border: 3px solid #e0e0e0;
      border-radius: 16px;
      padding: 40px 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .role-card:hover {
      border-color: #667eea;
      background: #f0f3ff;
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }

    .role-card .icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .role-card h3 {
      color: #333;
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 12px 0;
    }

    .role-card p {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin: 0;
    }

    .login-form {
      display: none;
    }

    .login-form.active {
      display: block;
    }

    .back-btn {
      background: none;
      border: none;
      color: #667eea;
      font-size: 14px;
      cursor: pointer;
      padding: 8px 0;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .back-btn:hover {
      gap: 12px;
      color: #5568d3;
    }

    .form-title {
      text-align: center;
      color: #333;
      font-size: 28px;
      margin: 0 0 30px 0;
      font-weight: 600;
    }

    .auth-footer {
      text-align: center;
      padding-top: 30px;
      border-top: 2px solid #f0f0f0;
      color: #666;
      font-size: 14px;
    }

    .auth-footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .login-body {
        padding: 30px 25px;
      }

      .role-cards {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .login-header h1 {
        font-size: 28px;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .role-cards {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="login-hero">
    <div class="login-container">
      <div class="login-header">
        <h1><i class="fas fa-graduation-cap"></i> MC Tutor</h1>
        <p>Cloud-Based Peer Tutoring Platform</p>
        <p class="institution">Mabini College Inc.</p>
      </div>

      <div class="login-body">
        <!-- Role Selection -->
        <div id="roleSelection" class="role-selection">
          <h2>Choose Your Role</h2>
          
          <div class="role-cards">
            <div class="role-card" onclick="selectRole('student')">
              <div class="icon">üìö</div>
              <h3>Student</h3>
              <p>I need help with my subjects and want to find tutors to guide me</p>
            </div>
            
            <div class="role-card" onclick="selectRole('tutor')">
              <div class="icon">üéì</div>
              <h3>Tutor</h3>
              <p>I want to share my knowledge and help fellow students succeed</p>
            </div>

            <div class="role-card" onclick="selectRole('admin')">
              <div class="icon">üë®‚Äçüíº</div>
              <h3>Admin</h3>
              <p>Manage platform, users, and oversee tutoring activities</p>
            </div>
          </div>

          <div class="auth-footer">
            Don't have an account? 
            <a href="/html/register.html">Register here</a>
          </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="login-form">
          <button class="back-btn" onclick="backToRoleSelection()">
            <i class="fas fa-arrow-left"></i> Back to role selection
          </button>

          <h2 class="form-title">
            <span id="roleLabel">Student</span> Login
          </h2>

          <form id="loginFormElement">
            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <div class="form-group">
              <label for="student_id"><i class="fas fa-id-card"></i> Student ID</label>
              <input 
                type="text" 
                id="student_id" 
                name="student_id" 
                placeholder="Enter your 6-digit student ID" 
                required
              >
            </div>

            <div class="form-group">
              <label for="password"><i class="fas fa-lock"></i> Password</label>
              <input 
                type="password" 
                id="password" 
                name="password" 
                placeholder="Enter your account password" 
                required
              >
            </div>

            <div style="text-align: right; margin-bottom: 20px;">
              <a href="/html/forgot-password.html" style="color: #667eea; font-size: 14px; text-decoration: none;">
                Forgot password?
              </a>
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn" style="width: 100%; padding: 15px; font-size: 16px;">
              <i class="fas fa-sign-in-alt"></i> Login
            </button>
          </form>

          <div class="auth-footer">
            Don't have an account? 
            <a href="/html/register.html" id="registerLink">Register here</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../scripts/utils.js"></script>
  <script src="../scripts/api.js"></script>
  <script src="../scripts/auth.js"></script>
  <script>
    let selectedRole = '';

    // Check if already logged in
    (function() {
      const user = window.auth?.getCurrentUser();
      if (user) {
        const dashboards = {
          'admin': 'admin-dashboard.html',
          'tutor': 'tutor-dashboard.html',
          'tutee': 'student-dashboard.html'
        };
        window.location.href = dashboards[user.role] || 'student-dashboard.html';
      }
    })();

    // Role selection
    function selectRole(role) {
      // Redirect admin to separate admin login page
      if (role === 'admin') {
        window.location.href = '/html/admin-login.html';
        return;
      }
      
      selectedRole = role;
      document.getElementById('roleSelection').style.display = 'none';
      document.getElementById('loginForm').classList.add('active');
      
      // Set role label
      const roleLabels = {
        'student': 'Student',
        'tutor': 'Tutor'
      };
      document.getElementById('roleLabel').textContent = roleLabels[role] || 'Student';
      
      // Update register link
      const registerLink = document.getElementById('registerLink');
      registerLink.href = `/html/register.html?role=${role}`;
    }

    // Back to role selection
    function backToRoleSelection() {
      document.getElementById('loginForm').classList.remove('active');
      document.getElementById('roleSelection').style.display = 'block';
      selectedRole = '';
      document.getElementById('loginFormElement').reset();
      document.getElementById('errorMessage').style.display = 'none';
    }

    // Handle login
    document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
      e.preventDefault();

      const studentId = document.getElementById('student_id').value.trim();
      const password = document.getElementById('password').value;
      const errorMessage = document.getElementById('errorMessage');
      const loginBtn = document.getElementById('loginBtn');

      errorMessage.style.display = 'none';
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';

      try {
        const response = await window.API.auth.login({
          student_id: studentId,
          password: password,
          role: selectedRole === 'student' ? 'tutee' : selectedRole
        });

        if (response.success && response.data) {
          window.auth.saveSession(response.data);
          
          if (window.utils && window.utils.showToast) {
            window.utils.showToast('Login successful!', 'success');
          }
          
          setTimeout(() => {
            window.auth.redirectToDashboard(response.data.user.role);
          }, 500);
        } else {
          throw new Error(response.message || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        errorMessage.textContent = error.message || 'Login failed. Please check your credentials.';
        errorMessage.style.display = 'block';
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
      }
    });

    // Check for role parameter in URL
    const urlParams = new URLSearchParams(window.location.search);
    const roleParam = urlParams.get('role');
    if (roleParam && (roleParam === 'student' || roleParam === 'tutor')) {
      selectRole(roleParam);
    }
  </script>
</body>
</html>
